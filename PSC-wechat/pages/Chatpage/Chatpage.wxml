<view class="chat-page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <view class="nav-back" bindtap="goBackMainPage">â†</view>
    <view class="nav-title">{{ counselor.name }}</view>
    <view class="end-consult-btn" bindtap="showRatingDialog">ç»“æŸå’¨è¯¢</view>
  </view>

  <!-- èŠå¤©æ¶ˆæ¯åŒº -->
  <scroll-view scroll-y="true" class="message-list" :scroll-into-view="toView">
    <block wx:for="{{messages}}" wx:key="index">
      <view class="message-item {{item.isSelf ? 'self' : 'other'}}">
        <view class="bubble">{{item.message}}</view>
      </view>
    </block>
    <view id="bottom"></view>
  </scroll-view>

  <!-- åº•éƒ¨è¾“å…¥åŒº -->
  <view class="input-area">
    <view class="emoji-button" bindtap="toggleEmojiPicker">ğŸ˜Š</view>
    <input class="input-box" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." value="{{inputMessage}}" bindinput="onInputChange" />
    <button class="send-button" bindtap="sendMessage">å‘é€</button>
  </view>

  <!-- è¡¨æƒ…é¢æ¿ -->
  <view class="emoji-picker" wx:if="{{showEmojiPicker}}">
    <block wx:for="{{emojiList}}" wx:key="index">
      <view class="emoji" bindtap="selectEmoji" data-emoji="{{item}}">{{item}}</view>
    </block>
  </view>

  <!-- è¯„åˆ†å¼¹çª— -->
  <view class="rating-dialog" wx:if="{{showRatingDialog}}">
    <view class="rating-content">
      <view class="rating-title">ä¸ºå’¨è¯¢å¸ˆæ‰“åˆ†</view>
      <view class="rating-stars">
        <view 
          wx:for="{{5}}" 
          wx:key="index" 
          class="star {{index < selectedRating ? 'active' : ''}}"
          bindtap="selectRating"
          data-rating="{{index + 1}}"
        >â˜…</view>
      </view>
      <view class="rating-buttons">
        <button class="cancel-btn" bindtap="hideRatingDialog">å–æ¶ˆ</button>
        <button class="confirm-btn {{selectedRating ? 'active' : ''}}" bindtap="submitRating" disabled="{{!selectedRating}}">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
